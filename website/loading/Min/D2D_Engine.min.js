var D2D_Engine=(function(){function a(c,e,b,q){this.canvas=document.getElementById(c);this.canvas.width=b;this.canvas.height=q;this.context2D=this.canvas.getContext("2d");this.canvasBuffer=document.createElement("canvas");this.canvasBuffer.width=b;this.canvasBuffer.height=q;this.contextBuffer2D=this.canvasBuffer.getContext("2d");this.fps=e;this.currentFps=0;this.frameCounter=0;this.timeCounter=0;this.canvas.mouseStates={leftButton:{down:false,up:false,click:false,dblclick:false},rightButton:{down:false,up:false,click:false,dblclick:false},middleButton:{down:false,up:false,click:false,dblclick:false},pos:{x:0,y:0},wheel:false,move:false,out:false,over:false,wheelDelta:0};function i(r){r=r||window.event;if(!-[1,]){switch(r.button){case 1:this.mouseStates.leftButton.down=true;break;case 2:this.mouseStates.rightButton.down=true;break;case 4:this.mouseStates.middleButton.down=true;break;}}else{switch(r.which){case 1:this.mouseStates.leftButton.down=true;break;case 2:this.mouseStates.middleButton.down=true;break;case 3:this.mouseStates.rightButton.down=true;break;}}r.preventDefault();}function k(r){r=r||window.event;if(!-[1,]){switch(r.button){case 1:this.mouseStates.leftButton.up=true;this.mouseStates.leftButton.down=false;break;case 2:this.mouseStates.rightButton.up=true;this.mouseStates.rightButton.down=false;break;case 4:this.mouseStates.middleButton.up=true;this.mouseStates.middleButton.down=false;break;}}else{switch(r.which){case 1:this.mouseStates.leftButton.up=true;this.mouseStates.leftButton.down=false;break;case 2:this.mouseStates.middleButton.up=true;this.mouseStates.middleButton.down=false;break;case 3:this.mouseStates.rightButton.up=true;this.mouseStates.rightButton.down=false;break;}}r.preventDefault();}function p(r){r=r||window.event;if(!-[1,]){switch(r.button){case 1:this.mouseStates.leftButton.click=true;break;case 2:this.mouseStates.rightButton.click=true;break;case 4:this.mouseStates.middleButton.click=true;break;}}else{switch(r.which){case 1:this.mouseStates.leftButton.click=true;break;case 2:this.mouseStates.middleButton.click=true;break;case 3:this.mouseStates.rightButton.click=true;break;}}r.preventDefault();}function o(r){r=r||window.event;if(!-[1,]){switch(r.button){case 1:this.mouseStates.leftButton.dblclick=true;break;case 2:this.mouseStates.rightButton.dblclick=true;break;case 4:this.mouseStates.middleButton.dblclick=true;break;}}else{switch(r.which){case 1:this.mouseStates.leftButton.dblclick=true;break;case 2:this.mouseStates.middleButton.dblclick=true;break;case 3:this.mouseStates.rightButton.dblclick=true;break;}}r.preventDefault();}function l(r){r=r||window.event;this.mouseStates.wheel=true;if(r.wheelDelta){this.mouseStates.wheelDelta=r.wheelDelta/120;}else{if(r.detail){this.mouseStates.wheelDelta=-r.detail/3;}}r.preventDefault();}function n(s){s=s||window.event;this.mouseStates.move=true;if(navigator.userAgent.indexOf("Firefox")>0){var r=this.getBoundingClientRect();this.mouseStates.pos.x=s.clientX-r.left;this.mouseStates.pos.y=s.clientY-r.top;}else{this.mouseStates.pos.x=s.offsetX;this.mouseStates.pos.y=s.offsetY;}s.preventDefault();}function j(r){r=r||window.event;this.mouseStates.out=true;this.mouseStates.leftButton.down=false;this.mouseStates.rightButton.down=false;this.mouseStates.middleButton.down=false;r.preventDefault();}function d(r){r=r||window.event;this.mouseStates.over=true;r.preventDefault();}function g(r){r=r||window.event;r.returnValue=false;r.preventDefault();}this.canvas.onmousedown=i;this.canvas.onmouseup=k;this.canvas.onclick=p;this.canvas.ondblclick=o;this.canvas.onmousewheel=l;this.canvas.onmousemove=n;this.canvas.onmouseout=j;this.canvas.onmouseover=d;this.canvas.oncontextmenu=g;this.canvas.addEventListener("DOMMouseScroll",l,false);this.canvas.touchStates={};function h(r){r=r||window.event;r.preventDefault();}function f(r){r=r||window.event;r.preventDefault();}function m(r){r=r||window.event;r.preventDefault();}this.canvas.addEventListener("touchstart",h,false);this.canvas.addEventListener("touchmove",f,false);this.canvas.addEventListener("touchend",m,false);}a.prototype.getContext=function(){return this.contextBuffer2D;};a.prototype.getCanvas=function(){return this.canvas;};a.prototype.beginDraw=function(){};a.prototype.endDraw=function(){this.context2D.drawImage(this.canvasBuffer,0,0);};a.prototype.clear=function(b){if(b==undefined||b==null){this.contextBuffer2D.clearRect(0,0,this.canvasBuffer.width,this.canvasBuffer.height);}else{this.contextBuffer2D.fillStyle=b;this.contextBuffer2D.fillRect(0,0,this.canvasBuffer.width,this.canvasBuffer.height);}};a.prototype.getFps=function(){return this.fps;};a.prototype.setFps=function(b){this.fps=b;};a.prototype.getCurrentFps=function(){return this.currentFps;};a.prototype.getWidth=function(){return this.canvas.width;};a.prototype.getCanvasWidth=a.prototype.getWidth;a.prototype.getHeight=function(){return this.canvas.height;};a.prototype.getCanvasHeight=a.prototype.getHeight;a.prototype.setWidth=function(b){this.canvas.width=b;this.canvasBuffer.width=b;};a.prototype.setCanvasWidth=a.prototype.setWidth;a.prototype.setHeight=function(b){this.canvas.height=b;this.canvasBuffer.height=b;};a.prototype.setCanvasHeight=a.prototype.setHeight;a.prototype.getMousePosX=function(){return this.canvas.mouseStates.pos.x;};a.prototype.getMousePosY=function(){return this.canvas.mouseStates.pos.y;};a.prototype.getMousePos=function(){return this.canvas.mouseStates.pos;};a.prototype.isMouseDown=function(b){if(b==undefined||b=="left"){return this.canvas.mouseStates.leftButton.down;}else{if(b=="right"){return this.canvas.mouseStates.rightButton.down;}else{if(b=="middle"){return this.canvas.mouseStates.middleButton.down;}else{return undefined;}}}};a.prototype.isMouseUp=function(b){if(b==undefined||b=="left"){return this.canvas.mouseStates.leftButton.up;}else{if(b=="right"){return this.canvas.mouseStates.rightButton.up;}else{if(b=="middle"){return this.canvas.mouseStates.middleButton.up;}else{return undefined;}}}};a.prototype.isMouseClick=function(b){if(b==undefined||b=="left"){return this.canvas.mouseStates.leftButton.click;}else{if(b=="right"){return this.canvas.mouseStates.rightButton.click;}else{if(b=="middle"){return this.canvas.mouseStates.middleButton.click;}else{return undefined;}}}};a.prototype.isMouseDblclick=function(b){if(b==undefined||b=="left"){return this.canvas.mouseStates.leftButton.dblclick;}else{if(b=="right"){return this.canvas.mouseStates.rightButton.dblclick;}else{if(b=="middle"){return this.canvas.mouseStates.middleButton.dblclick;}else{return undefined;}}}};a.prototype.isMouseMove=function(){return this.canvas.mouseStates.move;};a.prototype.isMouseWheel=function(){return this.canvas.mouseStates.wheel;};a.prototype.isMouseOut=function(){return this.canvas.mouseStates.out;};a.prototype.isMouseOver=function(){return this.canvas.mouseStates.over;};a.prototype.getMouseWheelDelta=function(){return this.canvas.mouseStates.wheelDelta;};a.prototype.getMouseWheel=a.prototype.getMouseWheelDelta;a.prototype.setCursorStyle=function(b){if(b==undefined){this.canvas.style.cursor="default";}else{this.canvas.style.cursor=b;}};a.prototype.setMouseStyle=a.prototype.setCursorStyle;a.prototype.getCursorStyle=function(){return this.canvas.style.cursor;};a.prototype.getMouseStyle=a.prototype.getCursorStyle;a.prototype.drawLine=function(e,g,d,f,c,b){this.contextBuffer2D.save();this.contextBuffer2D.beginPath();this.contextBuffer2D.moveTo(e,g);this.contextBuffer2D.lineTo(d,f);if(b!=undefined){this.contextBuffer2D.lineWidth=b;}else{this.contextBuffer2D.lineWidth=1;}this.contextBuffer2D.strokeStyle=c;this.contextBuffer2D.stroke();this.contextBuffer2D.restore();};a.prototype.drawFillRect=function(c,f,e,b,d){this.contextBuffer2D.save();this.contextBuffer2D.fillStyle=d;this.contextBuffer2D.fillRect(c,f,e,b);this.contextBuffer2D.restore();};a.prototype.drawStrokeRect=function(d,g,f,c,e,b){this.contextBuffer2D.save();if(b!=undefined){this.contextBuffer2D.lineWidth=b;}else{this.contextBuffer2D.lineWidth=1;}this.contextBuffer2D.strokeStyle=e;this.contextBuffer2D.strokeRect(d,g,f,c);this.contextBuffer2D.restore();};return a;})();function startEngine(a){a.lastTime=new Date().getTime();var b=function(){var d=new Date().getTime();var c=d-a.lastTime;if(c-1000/a.fps>=0){a.lastTime=d;a.frameCounter++;a.timeCounter+=c;if(a.timeCounter>=1000){a.timeCounter-=1000;a.currentFps=a.frameCounter;a.frameCounter=0;}if(a.update!=undefined){a.update(c/1000);}if(a.draw!=undefined){a.draw(c/1000);}a.canvas.mouseStates.leftButton.up=false;a.canvas.mouseStates.leftButton.click=false;a.canvas.mouseStates.leftButton.dblclick=false;a.canvas.mouseStates.rightButton.up=false;a.canvas.mouseStates.rightButton.click=false;a.canvas.mouseStates.rightButton.dblclick=false;a.canvas.mouseStates.middleButton.up=false;a.canvas.mouseStates.middleButton.click=false;a.canvas.mouseStates.middleButton.dblclick=false;a.canvas.mouseStates.wheel=false;a.canvas.mouseStates.move=false;a.canvas.mouseStates.out=false;a.canvas.mouseStates.over=false;a.canvas.mouseStates.wheelDelta=0;}};window.setInterval(b,1);}