function D2D_Engine(b,d,a,p){this.canvas=document.getElementById(b);this.canvas.width=a;this.canvas.height=p;this.context2D=this.canvas.getContext("2d");this.canvasBuffer=document.createElement("canvas");this.canvasBuffer.width=a;this.canvasBuffer.height=p;this.contextBuffer2D=this.canvasBuffer.getContext("2d");this.fps=d;this.currentFps=0;this.frameCounter=0;this.timeCounter=0;this.canvas.mouseStates={leftButton:{down:false,up:false,click:false,dblclick:false},rightButton:{down:false,up:false,click:false,dblclick:false},middleButton:{down:false,up:false,click:false,dblclick:false},pos:{x:0,y:0},wheel:false,move:false,out:false,over:false,wheelDelta:0};function h(q){q=q||window.event;if(!-[1,]){switch(q.button){case 1:this.mouseStates.leftButton.down=true;break;case 2:this.mouseStates.rightButton.down=true;break;case 4:this.mouseStates.middleButton.down=true;break;}}else{switch(q.which){case 1:this.mouseStates.leftButton.down=true;break;case 2:this.mouseStates.middleButton.down=true;break;case 3:this.mouseStates.rightButton.down=true;break;}}q.preventDefault();}function j(q){q=q||window.event;if(!-[1,]){switch(q.button){case 1:this.mouseStates.leftButton.up=true;this.mouseStates.leftButton.down=false;break;case 2:this.mouseStates.rightButton.up=true;this.mouseStates.rightButton.down=false;break;case 4:this.mouseStates.middleButton.up=true;this.mouseStates.middleButton.down=false;break;}}else{switch(q.which){case 1:this.mouseStates.leftButton.up=true;this.mouseStates.leftButton.down=false;break;case 2:this.mouseStates.middleButton.up=true;this.mouseStates.middleButton.down=false;break;case 3:this.mouseStates.rightButton.up=true;this.mouseStates.rightButton.down=false;break;}}q.preventDefault();}function o(q){q=q||window.event;if(!-[1,]){switch(q.button){case 1:this.mouseStates.leftButton.click=true;break;case 2:this.mouseStates.rightButton.click=true;break;case 4:this.mouseStates.middleButton.click=true;break;}}else{switch(q.which){case 1:this.mouseStates.leftButton.click=true;break;case 2:this.mouseStates.middleButton.click=true;break;case 3:this.mouseStates.rightButton.click=true;break;}}q.preventDefault();}function n(q){q=q||window.event;if(!-[1,]){switch(q.button){case 1:this.mouseStates.leftButton.dblclick=true;break;case 2:this.mouseStates.rightButton.dblclick=true;break;case 4:this.mouseStates.middleButton.dblclick=true;break;}}else{switch(q.which){case 1:this.mouseStates.leftButton.dblclick=true;break;case 2:this.mouseStates.middleButton.dblclick=true;break;case 3:this.mouseStates.rightButton.dblclick=true;break;}}q.preventDefault();}function k(q){q=q||window.event;this.mouseStates.wheel=true;if(q.wheelDelta){this.mouseStates.wheelDelta=q.wheelDelta/120;}else{if(q.detail){this.mouseStates.wheelDelta=-q.detail/3;}}q.preventDefault();}function m(r){r=r||window.event;this.mouseStates.move=true;if(navigator.userAgent.indexOf("Firefox")>0){var q=this.getBoundingClientRect();this.mouseStates.pos.x=r.clientX-q.left;this.mouseStates.pos.y=r.clientY-q.top;}else{this.mouseStates.pos.x=r.offsetX;this.mouseStates.pos.y=r.offsetY;}r.preventDefault();}function i(q){q=q||window.event;this.mouseStates.out=true;this.mouseStates.leftButton.down=false;this.mouseStates.rightButton.down=false;this.mouseStates.middleButton.down=false;q.preventDefault();}function c(q){q=q||window.event;this.mouseStates.over=true;q.preventDefault();}function f(q){q=q||window.event;q.returnValue=false;q.preventDefault();}this.canvas.onmousedown=h;this.canvas.onmouseup=j;this.canvas.onclick=o;this.canvas.ondblclick=n;this.canvas.onmousewheel=k;this.canvas.onmousemove=m;this.canvas.onmouseout=i;this.canvas.onmouseover=c;this.canvas.oncontextmenu=f;this.canvas.addEventListener("DOMMouseScroll",k,false);this.canvas.touchStates={};function g(q){q=q||window.event;q.preventDefault();}function e(q){q=q||window.event;q.preventDefault();}function l(q){q=q||window.event;q.preventDefault();}this.canvas.addEventListener("touchstart",g,false);this.canvas.addEventListener("touchmove",e,false);this.canvas.addEventListener("touchend",l,false);}D2D_Engine.prototype.getContext=function(){return this.contextBuffer2D;};D2D_Engine.prototype.getCanvas=function(){return this.canvas;};D2D_Engine.prototype.beginDraw=function(){};D2D_Engine.prototype.endDraw=function(){this.context2D.drawImage(this.canvasBuffer,0,0);};D2D_Engine.prototype.clear=function(a){if(a==undefined||a==null){this.contextBuffer2D.clearRect(0,0,this.canvasBuffer.width,this.canvasBuffer.height);}else{this.contextBuffer2D.fillStyle=a;this.contextBuffer2D.fillRect(0,0,this.canvasBuffer.width,this.canvasBuffer.height);}};D2D_Engine.prototype.getFps=function(){return this.fps;};D2D_Engine.prototype.setFps=function(a){this.fps=a;};D2D_Engine.prototype.getCurrentFps=function(){return this.currentFps;};D2D_Engine.prototype.getWidth=function(){return this.canvas.width;};D2D_Engine.prototype.getCanvasWidth=D2D_Engine.prototype.getWidth;D2D_Engine.prototype.getHeight=function(){return this.canvas.height;};D2D_Engine.prototype.getCanvasHeight=D2D_Engine.prototype.getHeight;D2D_Engine.prototype.setWidth=function(a){this.canvas.width=a;this.canvasBuffer.width=a;};D2D_Engine.prototype.setCanvasWidth=D2D_Engine.prototype.setWidth;D2D_Engine.prototype.setHeight=function(a){this.canvas.height=a;this.canvasBuffer.height=a;};D2D_Engine.prototype.setCanvasHeight=D2D_Engine.prototype.setHeight;D2D_Engine.prototype.getMousePosX=function(){return this.canvas.mouseStates.pos.x;};D2D_Engine.prototype.getMousePosY=function(){return this.canvas.mouseStates.pos.y;};D2D_Engine.prototype.getMousePos=function(){return this.canvas.mouseStates.pos;};D2D_Engine.prototype.isMouseDown=function(a){if(a==undefined||a=="left"){return this.canvas.mouseStates.leftButton.down;}else{if(a=="right"){return this.canvas.mouseStates.rightButton.down;}else{if(a=="middle"){return this.canvas.mouseStates.middleButton.down;}else{return undefined;}}}};D2D_Engine.prototype.isMouseUp=function(a){if(a==undefined||a=="left"){return this.canvas.mouseStates.leftButton.up;}else{if(a=="right"){return this.canvas.mouseStates.rightButton.up;}else{if(a=="middle"){return this.canvas.mouseStates.middleButton.up;}else{return undefined;}}}};D2D_Engine.prototype.isMouseClick=function(a){if(a==undefined||a=="left"){return this.canvas.mouseStates.leftButton.click;}else{if(a=="right"){return this.canvas.mouseStates.rightButton.click;}else{if(a=="middle"){return this.canvas.mouseStates.middleButton.click;}else{return undefined;}}}};D2D_Engine.prototype.isMouseDblclick=function(a){if(a==undefined||a=="left"){return this.canvas.mouseStates.leftButton.dblclick;}else{if(a=="right"){return this.canvas.mouseStates.rightButton.dblclick;}else{if(a=="middle"){return this.canvas.mouseStates.middleButton.dblclick;}else{return undefined;}}}};D2D_Engine.prototype.isMouseMove=function(){return this.canvas.mouseStates.move;};D2D_Engine.prototype.isMouseWheel=function(){return this.canvas.mouseStates.wheel;};D2D_Engine.prototype.isMouseOut=function(){return this.canvas.mouseStates.out;};D2D_Engine.prototype.isMouseOver=function(){return this.canvas.mouseStates.over;};D2D_Engine.prototype.getMouseWheelDelta=function(){return this.canvas.mouseStates.wheelDelta;};D2D_Engine.prototype.getMouseWheel=D2D_Engine.prototype.getMouseWheelDelta;D2D_Engine.prototype.setCursorStyle=function(a){if(a==undefined){this.canvas.style.cursor="default";}else{this.canvas.style.cursor=a;}};D2D_Engine.prototype.setMouseStyle=D2D_Engine.prototype.setCursorStyle;D2D_Engine.prototype.getCursorStyle=function(){return this.canvas.style.cursor;};D2D_Engine.prototype.getMouseStyle=D2D_Engine.prototype.getCursorStyle;D2D_Engine.prototype.drawLine=function(d,f,c,e,b,a){this.contextBuffer2D.save();this.contextBuffer2D.beginPath();this.contextBuffer2D.moveTo(d,f);this.contextBuffer2D.lineTo(c,e);if(a!=undefined){this.contextBuffer2D.lineWidth=a;}else{this.contextBuffer2D.lineWidth=1;}this.contextBuffer2D.strokeStyle=b;this.contextBuffer2D.stroke();this.contextBuffer2D.restore();};D2D_Engine.prototype.drawFillRect=function(b,e,d,a,c){this.contextBuffer2D.save();this.contextBuffer2D.fillStyle=c;this.contextBuffer2D.fillRect(b,e,d,a);this.contextBuffer2D.restore();};D2D_Engine.prototype.drawStrokeRect=function(c,f,e,b,d,a){this.contextBuffer2D.save();if(a!=undefined){this.contextBuffer2D.lineWidth=a;}else{this.contextBuffer2D.lineWidth=1;}this.contextBuffer2D.strokeStyle=d;this.contextBuffer2D.strokeRect(c,f,e,b);this.contextBuffer2D.restore();};function startEngine(a){a.lastTime=new Date().getTime();var b=function(){var d=new Date().getTime();var c=d-a.lastTime;if(c-1000/a.fps>=0){a.lastTime=d;a.frameCounter++;a.timeCounter+=c;if(a.timeCounter>=1000){a.timeCounter-=1000;a.currentFps=a.frameCounter;a.frameCounter=0;}if(a.update!=undefined){a.update(c/1000);}if(a.draw!=undefined){a.draw(c/1000);}a.canvas.mouseStates.leftButton.up=false;a.canvas.mouseStates.leftButton.click=false;a.canvas.mouseStates.leftButton.dblclick=false;a.canvas.mouseStates.rightButton.up=false;a.canvas.mouseStates.rightButton.click=false;a.canvas.mouseStates.rightButton.dblclick=false;a.canvas.mouseStates.middleButton.up=false;a.canvas.mouseStates.middleButton.click=false;a.canvas.mouseStates.middleButton.dblclick=false;a.canvas.mouseStates.wheel=false;a.canvas.mouseStates.move=false;a.canvas.mouseStates.out=false;a.canvas.mouseStates.over=false;a.canvas.mouseStates.wheelDelta=0;}};window.setInterval(b,1);}